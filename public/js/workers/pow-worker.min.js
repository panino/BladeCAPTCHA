self.addEventListener("message",async e=>{const{challenge:t,difficulty:s,loguear:a,progress:r,start:n=0,end:o=1/0,timeFactor:i=1,targetTime:d}=e.data,l="0".repeat(s),c=new TextEncoder,f=async e=>{const t=c.encode(e),s=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(s)).map(e=>e.toString(16).padStart(2,"0")).join("")};let g=n;const p=Date.now(),m=Math.max(3*d,2e3*s)*i;let u=0;for(;g<o;){if((await f(t+g)).startsWith(l))return void self.postMessage({nonce:g});if(g++,r&&g%100==0){let e=(g-n)/(o-n)*100;e>100&&(e=100),e>=u&&(u=e,self.postMessage({perc:e.toFixed(2),start:n,end:o}))}if(Date.now()-p>m)return void self.postMessage({done:!0,partial:!0,nextStart:g,end:o});a&&g%1e4==0&&self.postMessage({log:!0})}self.postMessage({done:!0,start:n,end:o})});