self.addEventListener("message",async e=>{const{challenge:t,difficulty:s,loguear:a,progress:o}=e.data,n="0".repeat(s),r=new TextEncoder,i=async e=>{const t=r.encode(e),s=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(s)).map(e=>e.toString(16).padStart(2,"0")).join("")};let l=0;const c=Date.now(),d=1e4+3e3*s;let f=d,g=d,p=0;for(;;){if((await i(t+l)).startsWith(n))return void self.postMessage({nonce:l});if(l++,a&&l%1e4==0){f=12e4*(Date.now()-c)/l,g=Math.max(d,f),self.postMessage({log:`Calculando... (${l} intentos)`})}if(o&&l%100==0){let e=100*(Date.now()-c)/g;e>100&&(e=100),e>=p&&(p=e,self.postMessage({perc:e.toFixed(2)}))}if(Date.now()-c>g)return void self.postMessage({error:"Tiempo de c√°lculo excedido"})}});