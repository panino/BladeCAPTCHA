<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dos formularios protegidos con BladeCAPTCHA</title>
  <link rel="stylesheet" href="../css/captcha.css" />
  <style>
	  :root {
		--header-height: 60px;
	  }
	  html {
		scroll-padding-top: var(--header-height);
	  }
	  .sticky-header {
		position: sticky;
		top: 0;
		background-color: #1e1e1e;
		color: #f5f5f5;
		height: var(--header-height);
		display: flex;
		align-items: center;
		padding: 0 1rem;
		z-index: 1000;
		border-bottom: 1px solid #444;
	  }
	 .sticky-header nav {
		display: flex;
		justify-content: space-between;
		width: 100%;
		max-width: 1024px;
		margin: 0 auto;
	  }
	  .sticky-header .logo {
		font-weight: bold;
		font-size: 1.2rem;
		text-decoration: none;
		color: inherit;
	  }
	  .sticky-header .nav-links {
		list-style: none;
		display: flex;
		gap: 1rem;
		margin: 0;
		padding: 0;
	  }
	   .sticky-header .nav-links a {
		color: inherit;
		text-decoration: none;
		font-weight: 500;
	  }
	   .sticky-header .nav-links a:hover,
	   .sticky-header .nav-links a:focus {
		text-decoration: underline;
	  }
	  body{
		width:100%;
		padding:0!important;
		margin:0 auto;
	  }
	  main {
		margin:auto;
		margin-top: var(--header-height);
		padding: 0 2rem 2rem 2rem;
		max-width: 600px;
		padding-bottom:20px;
		
	  }
	  footer {
		text-align: center;
		margin-top: 4rem;
		color: #999;
		font-size: 0.9rem;
		position: fixed;
		bottom:0;
		left:0;
		background:#fff;
		width:100%;
	  }
	 
	</style>
  <style>
    form {
      margin-bottom: 2em;
      padding: 1em;
      border-radius: 6px;
	  background:#cacaca;
    }
    progress {
      width: 100%;
      visibility: hidden;
    }
    #status1, #status2 {
      margin-top: 0.5em;
      min-height: 1.4em;
      color: #000;
	  line-height:2.5rem;
	  padding:0 1rem;
    }
  </style>
</head>
<body>
<header class="sticky-header">
  <nav>
    <a href="../../../landing/index.html" class="logo" aria-label="BladeCAPTCHA home">🐢 BladeCAPTCHA</a>
    <ul class="nav-links">
      <li><a href="../../../landing/index.html">Inicio</a></li>
      <li><a href="../../../landing/documentacion.html">Documentación</a></li>
      <li><a href="https://github.com/panino/BladeCAPTCHA" target="_blank" rel="noopener noreferrer">GitHub</a></li>
      <li><a href="../../../landing/en" lang="en" hreflang="en">English</a></li>
    </ul>
  </nav>
</header>
<main>
  <h1>Dos formularios protegidos con BladeCAPTCHA</h1>

  <form id="form1" method="post" action="../php/procesar-formulario.php">
    <label>Nombre Form 1:
      <input type="text" name="nombre" placeholder="Escribe tu nombre" />
    </label>
    <button id="submitBtn1" type="submit">Enviar Form 1</button>
    <progress id="progreso1" max="100" value="0" aria-label="Progreso CAPTCHA Form 1">0%</progress>
    <div id="status1" role="status" aria-live="polite"></div>
  </form>

  <form id="form2" method="post" action="../php/procesar-formulario.php">
    <label>Nombre Form 2:
      <input type="text" name="nombre" placeholder="Escribe tu nombre" />
    </label>
    <button id="submitBtn2" type="submit">Enviar Form 2</button>
    <progress id="progreso2" max="100" value="0" aria-label="Progreso CAPTCHA Form 2">0%</progress>
    <div id="status2" role="status" aria-live="polite"></div>
  </form>

  <script type="module">
	import { initCaptcha } from '../js/captcha.min.js';
    const formsConfig = [
		{
			formSelector: '#form1',
			inputName: 'captcha_token',
			statusSelector: '#status1',
			submitButtonSelector: '#submitBtn1',
			onStart: () => {
				const btn = document.querySelector('#submitBtn1');
				btn.dataset.originalText = btn.textContent;
				btn.textContent = 'Verificando...';
				btn.disabled = true;
				btn.style.cursor = 'wait';
			},
			onEnd: () => {
				const btn = document.querySelector('#submitBtn1');
				btn.textContent = btn.dataset.originalText;
				btn.disabled = false;
				btn.style.cursor = 'pointer';
			},
			onProgress: (p) => {
				const prog = document.querySelector('#progreso1');
				prog.style.visibility = p ? 'visible' : 'hidden';
				prog.value = p;
				if (p === 100) setTimeout(() => (prog.style.visibility = 'hidden'), 100);
			}
		},
		{
			formSelector: '#form2',
			inputName: 'captcha_token',
			statusSelector: '#status2',
			submitButtonSelector: '#submitBtn2',
			onStart: () => {
				const btn = document.querySelector('#submitBtn2');
				btn.dataset.originalText = btn.textContent;
				btn.textContent = 'Verificando...';
				btn.disabled = true;
				btn.style.cursor = 'wait';
			},
			onEnd: () => {
				const btn = document.querySelector('#submitBtn2');
				btn.textContent = btn.dataset.originalText;
				btn.disabled = false;
				btn.style.cursor = 'pointer';
			},
			onProgress: (p) => {
				const prog = document.querySelector('#progreso2');
				prog.style.visibility = p ? 'visible' : 'hidden';
				prog.value = p;
				if (p === 100) setTimeout(() => (prog.style.visibility = 'hidden'), 100);
			}
		}
    ];

    async function initAllCaptchas() {
		for (const config of formsConfig) {
			try {
				await initCaptcha({ mode: 'autoFormIntegration', ...config });
			} catch (err) {
				console.error(err || err.message);
			}
		}
	}
	initAllCaptchas();
  </script>
  <footer>
    <p>BladeCAPTCHA · Documentación técnica · MIT License</p>
  </footer>
  </main>
</body>
</html>
